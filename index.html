<!DOCTYPE html>
<html>
<head>
  <title>Conference Map with Nested Filters</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { margin:0; padding:0; display:flex; }
    #sidebar {
      width: 240px;
      padding: 10px;
      background: #f8f8f8;
      border-right: 1px solid #ddd;
      font-family: sans-serif;
      overflow-y: auto;
      height: 100vh;
    }
    #map { flex:1; height:100vh; }
    h3 { margin-top: 20px; margin-bottom: 5px; }
    .subcategory { margin-left: 20px; }
  </style>
</head>
<body>
  <div id="sidebar">
    <h3><input type="checkbox" id="firstHalfParent"> First Part of Year</h3>
    <div class="subcategory">
      <label><input type="checkbox" class="firstHalfChild" id="liver"> Liver</label><br>
      <label><input type="checkbox" class="firstHalfChild" id="heart"> Heart</label>
    </div>

    <h3><input type="checkbox" id="secondHalfParent"> Second Part of Year</h3>
    <div class="subcategory">
      <label><input type="checkbox" class="secondHalfChild" id="diabetes"> Diabetes</label><br>
      <label><input type="checkbox" class="secondHalfChild" id="brain"> Brain</label>
    </div>
  </div>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    var map = L.map('map').setView([48.8566, 2.3522], 3);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    // Marker icons
    var greenIcon = new L.Icon({iconUrl:'https://cdn.jsdelivr.net/gh/pointhi/leaflet-color-markers@master/img/marker-icon-green.png', shadowUrl:'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png', iconSize:[25,41], iconAnchor:[12,41], popupAnchor:[1,-34], shadowSize:[41,41]});
    var redIcon = new L.Icon({iconUrl:'https://cdn.jsdelivr.net/gh/pointhi/leaflet-color-markers@master/img/marker-icon-red.png', shadowUrl:'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png', iconSize:[25,41], iconAnchor:[12,41], popupAnchor:[1,-34], shadowSize:[41,41]});
    var blueIcon = new L.Icon({iconUrl:'https://cdn.jsdelivr.net/gh/pointhi/leaflet-color-markers@master/img/marker-icon-blue.png', shadowUrl:'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png', iconSize:[25,41], iconAnchor:[12,41], popupAnchor:[1,-34], shadowSize:[41,41]});
    var purpleIcon = new L.Icon({iconUrl:'https://cdn.jsdelivr.net/gh/pointhi/leaflet-color-markers@master/img/marker-icon-violet.png', shadowUrl:'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png', iconSize:[25,41], iconAnchor:[12,41], popupAnchor:[1,-34], shadowSize:[41,41]});

    // Markers
    var liverMarkers = [
      L.marker([48.8566, 2.3522], {icon: greenIcon}).bindPopup("<b>AHA Conference</b><br>Feb 10-12, 2026<br>Liver conference in Paris"),
      L.marker([52.5200, 13.4050], {icon: greenIcon}).bindPopup("<b>SABC Conference</b><br>Mar 5-7, 2026<br>Liver conference in Berlin")
    ];
    var heartMarkers = [
      L.marker([41.9028, 12.4964], {icon: redIcon}).bindPopup("<b>Heart Conference</b><br>Apr 15-17, 2026<br>Heart conference in Rome")
    ];
    var diabetesMarkers = [
      L.marker([40.7128, -74.0060], {icon: blueIcon}).bindPopup("<b>Diabetes Conference</b><br>Sep 20-22, 2026<br>Diabetes conference in NYC")
    ];
    var brainMarkers = [
      L.marker([35.6895, 139.6917], {icon: purpleIcon}).bindPopup("<b>Brain Conference</b><br>Oct 12-14, 2026<br>Brain conference in Tokyo")
    ];

    // Helper: toggle markers on/off
    function setMarkers(markers, show){
      markers.forEach(m => {
        if(show) map.addLayer(m);
        else map.removeLayer(m);
      });
    }

    // Child checkbox event
    function setupChild(childId, markers, parentCheckbox){
      const child = document.getElementById(childId);
      child.addEventListener('change', function(){
        setMarkers(markers, this.checked);

        // update parent
        const siblings = document.getElementsByClassName(child.classList[0]);
        parentCheckbox.checked = Array.from(siblings).every(c => c.checked);
      });
    }

    // Parent checkbox event
    function setupParent(parentId, childClass){
      const parent = document.getElementById(parentId);
      parent.addEventListener('change', function(){
        const children = document.getElementsByClassName(childClass);
        Array.from(children).forEach(c => {
          c.checked = this.checked;
          c.dispatchEvent(new Event('change')); // trigger child change
        });
      });
    }

    // Set up parent/child relationships
    setupParent('firstHalfParent', 'firstHalfChild');
    setupParent('secondHalfParent', 'secondHalfChild');

    setupChild('liver', liverMarkers, document.getElementById('firstHalfParent'));
    setupChild('heart', heartMarkers, document.getElementById('firstHalfParent'));
    setupChild('diabetes', diabetesMarkers, document.getElementById('secondHalfParent'));
    setupChild('brain', brainMarkers, document.getElementById('secondHalfParent'));

    // Show Liver by default
    document.getElementById('liver').checked = true;
    setMarkers(liverMarkers, true);
    document.getElementById('firstHalfParent').checked = false;
  </script>
</body>
</html>
